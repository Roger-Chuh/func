function CalcIntrDiffByBearing()


R1_w_mask = reshape([0.7724639435 0.4421627665 -0.4558415777 -0.4117679336 0.8951875072 0.1705476347 0.4834734996 0.05595904605 0.8735685207], 3,3);
t1_w_mask = [-0.08239263153 0.02002289396 -0.0232259761];
R1_wo_mask = reshape([0.7762185644 0.4410814925 -0.4504795859 -0.4148458721 0.8953761177 0.1618780725 0.4747500845 0.06122683165 0.877988401], 3,3);
t1_wo_mask = [-0.08251716285 0.02014173092 -0.0227255118];

R2_w_mask = reshape([0.7714239622 0.4414637703 -0.4582737283 -0.4126635504 0.8952932544 0.167805789 0.484369554 0.05966345712 0.8728266764], 3,3);
t2_w_mask = [-0.08248229226 0.01997109516 -0.02338264675];
R2_wo_mask = reshape([0.7753998832 0.4415846493 -0.4513956344 -0.4148547948 0.8951558221 0.1630691675 0.4760782713 0.06081982988 0.8772972289], 3,3);
t2_wo_mask = [-0.08262813855 0.020058801 -0.02283062338];

R3_w_mask = reshape([0.7730446902 0.4411299529 -0.4558577317 -0.4129482634 0.8954532565 0.16624439 0.4815346703 0.05973131569 0.8743892332], 3,3);
t3_w_mask = [-0.08256207175 0.01998555171 -0.02321576486];
R3_wo_mask = reshape([0.7758586785 0.4416327984 -0.4505594106 -0.4144849521 0.8952062709 0.1637313563 0.4756527468 0.05971770196 0.8776037036], 3,3);
t3_wo_mask = [-0.08266935336 0.02005299464 -0.02280741511];



width = 1280;
height = 1024;

[xMat, yMat] = meshgrid(1:width, 1:height);
pix = [xMat(:) yMat(:)];


param11_w_mask = [475.9797948 476.3259531 636.3863884 529.6336053 0.04877802072 -0.05995137064 0.01756838109 0.008940807887 -0.009170490159 0.001964245567 0.003050153492 0.006792501091 0.0007587387656 -0.0001075464647 -0.01281661545 -0.001132734063 0.0003147264906 7.153679759e-05 0.004425382523 0.0109242564];
param12_w_mask = [474.0445544 474.0959506 646.753686 504.0686916 0.05284306425 -0.06999166657 0.02747088326 0.005629768208 -0.00950253495 0.002261985713 -0.006505138072 -0.00257831445 0.002249022718 0.0002699316317 0.008192496236 0.001324977294 -0.0004717529847 -0.0001899459983 -0.005858855434 -0.01966607582];

param11_wo_mask = [475.7270438 476.0761839 637.8767772 528.2797092 0.05318143937 -0.07788284489 0.05056738402 -0.02109188015 0.004067923314 -0.0002934613542 0.003285407402 0.006587180816 5.031599543e-05 -0.0009335657521 -0.01258374318 0.0003579493231 0.0005410527063 -0.0004771399403 0.003928720027 0.01040612259];
param12_wo_mask = [473.8504854 473.8970528 644.4734597 506.6041557 0.05593204833 -0.08405376259 0.05625375027 -0.02336351043 0.004556021629 -0.0003596637341 -0.006722140141 -0.0009315435365 0.003467549282 0.001161602489 0.006054718092 -0.0007254441379 -0.0006882166333 0.0005290670792 -0.007450755427 -0.01854299558];

param21_w_mask = [475.9142543 476.2633828 635.9229758 528.9399587 0.04788968715 -0.05616756965 0.01043415085 0.01544063171 -0.01201780675 0.002447612984 0.002815091242 0.007206604632 0.001144536712 0.0001630201805 -0.01275371228 -0.0012309789 0.0002372872037 0.0001433607796 0.00327741618 0.01071854805];
param22_w_mask = [473.8648706 473.9557539 647.2024432 505.2087365 0.05214885473 -0.06797571255 0.02510754741 0.006906552134 -0.009770644652 0.002269220194 -0.006321704662 -0.001505100525 0.001866093724 4.049802805e-05 0.006361674107 0.001329809232 -0.0003875730676 -0.0002566985832 -0.007360640082 -0.01964207294];

param21_wo_mask = [475.7669354 476.1143765 637.1500662 528.750315 0.05211706732 -0.07449572702 0.04534969025 -0.01718669733 0.002673138032 -0.0001011895699 0.002860822622 0.007027354099 0.0007298019282 -0.0005992950934 -0.01304729693 -0.0001373491145 0.0004684982182 -0.0003364230761 0.003505347292 0.009965829359];
param22_wo_mask = [473.7437183 473.822647 644.4854288 506.9316614 0.05554561229 -0.08367391448 0.05684369202 -0.02456373398 0.005241060755 -0.0004870132129 -0.006517121298 -0.0003050356038 0.003229137318 0.00118896313 0.004968286289 -0.0003580862101 -0.0006858129241 0.0003772761403 -0.008585546561 -0.01814165];

param31_w_mask = [475.9035784 476.2014109 637.3165675 528.5765469 0.04652855005 -0.05166781649 0.003793133254 0.02047437045 -0.01395132895 0.002745820228 0.001957953111 0.006107076449 0.001157163111 7.715895577e-05 -0.01147295374 -0.001148745493 0.0001845134009 0.0001258161084 0.005265300667 0.008102570537];
param32_w_mask = [473.951491 474.012033 646.9552101 505.0110571 0.05231347883 -0.06848806548 0.02497672013 0.007832977053 -0.01042146113 0.00240294941 -0.006914308101 -0.0008881730578 0.002633725415 6.120049295e-05 0.005705001647 0.001411377156 -0.0003878002583 -0.0002615378487 -0.008586397683 -0.02062676687];

param31_wo_mask = [475.7553443 476.052668 637.984983 528.8581973 0.05111331284 -0.07188239594 0.04269764146 -0.01601969029 0.002473101909 -9.436610327e-05 0.002158296115 0.005660776695 0.0008080859736 -0.0004443802567 -0.01166478191 -0.0003063772145 0.0003594748952 -0.0002801374749 0.006353625723 0.008048894596];
param32_wo_mask = [473.8074542 473.8646045 644.8311916 506.2778618 0.05587148797 -0.08483279888 0.05792653469 -0.02476734614 0.005108774236 -0.0004444648641 -0.007335273656 4.333366348e-06 0.003889798707 0.001099956112 0.004813079372 -0.0001075854601 -0.0006864280343 0.0003384477589 -0.009501578557 -0.01998894952];

param1 = param32_w_mask;
param2 = param32_wo_mask;
err_vec = zeros(size(pix,1), 1);
for i = 1 : size(pix,1)
    [pt3d1] = UnProjectKB20(pix(i,1),pix(i,2), param1(1),param1(2),param1(3),param1(4),param1(5),param1(6),param1(7),param1(8),param1(9),param1(10),param1(11),param1(12),param1(13),param1(14),param1(15),param1(16),param1(17),param1(18),param1(19),param1(20));
    [pt2d1] = ProjectKB20(pt3d1(1),pt3d1(2),pt3d1(3), param1(1),param1(2),param1(3),param1(4),param1(5),param1(6),param1(7),param1(8),param1(9),param1(10),param1(11),param1(12),param1(13),param1(14),param1(15),param1(16),param1(17),param1(18),param1(19),param1(20));
    assert(abs(norm(pt3d1) - 1) < 0.0001);
    valid1 = false;
    if (norm(pt2d1 - pix(i,:)) < 0.001)
        valid1 = true;
    end
    
    [pt3d2] = UnProjectKB20(pix(i,1),pix(i,2), param2(1),param2(2),param2(3),param2(4),param2(5),param2(6),param2(7),param2(8),param2(9),param2(10),param2(11),param2(12),param2(13),param2(14),param2(15),param2(16),param2(17),param2(18),param2(19),param2(20));
    [pt2d2] = ProjectKB20(pt3d2(1),pt3d2(2),pt3d2(3), param2(1),param2(2),param2(3),param2(4),param2(5),param2(6),param2(7),param2(8),param2(9),param2(10),param2(11),param2(12),param2(13),param2(14),param2(15),param2(16),param2(17),param2(18),param2(19),param2(20));
    assert(abs(norm(pt3d2) - 1) < 0.0001);
    valid2 = false;
    if (norm(pt2d2 - pix(i,:)) < 0.001)
        valid2 = true;
    end
    
    
    if (valid1 && valid2)
%         bearing_err = norm(pt3d2 - pt3d1);
        bearing_err = CalcDegree(pt3d2, pt3d1);
        err_vec(i,1) = bearing_err;
    end
end

errMat = reshape(err_vec, height, width);
errMat(errMat == 0) = nan;
mean_ang_err = mean(err_vec(err_vec~=0));
figure,imshow(errMat, []);title(sprintf('mean ang err: %f deg', mean_ang_err));
% figure,surface(errMat);title(sprintf('mean ang err: %f deg', mean_ang_err));
end